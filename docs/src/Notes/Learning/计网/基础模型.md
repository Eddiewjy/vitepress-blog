# 概览

![网络架构](../img/network.png)

# 从键入url来入手

## 输入网址-生成http消息

> 浏览器先解析url，生成http请求消息

- url的组成为：
  - 协议：`http://`
  - 域名（服务器）：`www.example.com`
  - 端口号：`80`
  - 路径：`/index.html`
- 后面的路径可以理解为**服务器的文件地址**
- 请求和响应报文的示例格式如下：

```http
GET /index.html HTTP/1.1
Host: www.example.com
```

```http
HTTP/1.1 200 OK
Content-Type: text/html
<html>
  <head>
    <title>Example</title>
  </head>
  <body>
    <h1>Hello, world!</h1>
  </body>
</html>
```

## DNS解析

> DNS服务器通过域名解析成ip地址

域名解析流程如下：

1. 浏览器先查找本地DNS缓存
2. 如果没有，则向本地DNS服务器发送请求
3. 本地DNS服务器查询根DNS服务器，获取顶级域名服务器的地址
4. 本地DNS服务器向顶级域名服务器发送请求，获取权威DNS服务器的地址
5. 本地DNS服务器向权威DNS服务器发送请求，获取域名对应的IP地址
6. 本地DNS服务器将IP地址返回给浏览器
7. 浏览器将IP地址缓存到本地DNS缓存中

> DNS 域名解析的过程蛮有意思的，整个过程就和我们日常生活中找人问路的过程类似，只指路不带路。

## TCP三次握手

> TCP协议通过三次握手建立连接

tcp的报文格式里比较重要的有

1. 双方端口号
2. 包本身的序列号
3. 状态位。SYN 是发起一个连接，ACK 是回复，RST 是重新连接，FIN 是结束连接等
4. 窗口大小。表示接收方的缓冲区大小。这和**流量控制**和**拥塞控制**来说很重要

三次握手简化版：

1. 客户端发送一个SYN包，告诉服务器要建立连接
2. 服务器回复一个SYN+ACK包，告诉客户端可以建立连接
3. 客户端回复一个ACK包，告诉服务器连接建立成功
4. 连接建立成功，双方可以开始通信

建立连接后，现在的报文就由tcp+http组成了

## IP寻址

> TCP协议通过IP地址进行寻址

IP地址主要分为源IP和目标IP。如果客户端使用了多个网卡就有多个IP，此时就要依赖 **路由表** 进行确认，通过目标IP地址与子网掩码Genmarkmark进行与运算，得到目标IP地址所在的子网，然后根据路由表进行转发

## MAC头

MAC 头部是以太网使用的头部，它包含了接收方和发送方的 MAC 地址等信息，用于两点间的传输。

> `ARP` 协议用于将 IP 地址解析为 MAC 地址，会在以太网内广播请求，询问哪个主机拥有某个 IP 地址。拥有该 IP 地址的主机会回复其 MAC 地址。

当然也不会每次都进行广播，os有一块`arp缓存`保存映射关系，有效期20分钟。

## 物理层

网卡会为报文加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列。随后经过交换机和路由器转发到目的地，整个传输过程就结束了。
