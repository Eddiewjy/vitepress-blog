# 基本架构

# 生产构建
## api处理和环境区分
vite支持客户端和服务端两种环境，能处理不同的构建配置请求；`BuildEnvironment`类可以初始化插件并配置环境；`builder` 系统就是为了区分环境、适配插件而存在的，配备有一些错误处理机制；根据配置的api进行rollup适配后交给rollup进行打包。这一步核心就是一些外部变量注入。
## rollup打包
这部分要跳到rollup源码里看
`rollupInternal` 是内核函数，只接受两个核心参数：rollup的配置选项和watcher监视器，前者是开发者手动设定的配置选项（经过预处理），后者是一个监听器，监听变化并在改变时重新构建。
### 构建 build
1. 解析入口点和选项
2. 构建模块依赖图
3. 转换代码并应用树摇
4. 生成优化的输出代码
5. 应用适当的输出格式
6. 写入最终结果

### 生成 generate


## bundle输出


# 开发